# ================================================================================
# Copyright (c) 2017-2018 AT&T Intellectual Property. All rights reserved.
# ================================================================================
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ============LICENSE_END=========================================================
#
# ECOMP is a trademark and service mark of AT&T Intellectual Property.
tosca_definitions_version: cloudify_dsl_1_3

imports:
  - http://www.getcloudify.org/spec/cloudify/3.4/types.yaml
  - {{ ONAPTEMPLATE_RAWREPOURL_org_onap_dcaegen2 }}/type_files/cdap/14.2.5/cdap_types.yaml
  - {{ ONAPTEMPLATE_RAWREPOURL_org_onap_dcaegen2 }}/type_files/dcaepolicy/1.0.0/node-type.yaml

inputs:
  hello_world_jar_url:
    type: string
  connected_broker_dns_name:
    type: string
    default : "cdap_broker"

node_templates:
  hw_app_policy_test:
    type: dcae.nodes.policy
    properties:
      policy_id : DCAE_alex.Config_test_cdap_policy

  hw_cdap_app:
    type: dcae.nodes.MicroService.cdap
    properties:
      service_component_type:
        'hello_world'
      jar_url: { get_input : hello_world_jar_url }
      artifact_name: "HelloWorld"
      artifact_version: "3.4.3"
      namespace: "cloudifyhwtest"
      programs:
        [{"program_type" : "flows", "program_id" : "WhoFlow"}, {"program_type" : "services", "program_id" : "Greeting"}]
      streamname:
        'who'
      service_endpoints:
        [{"service_name" : "Greeting", "service_endpoint" : "greet", "endpoint_method" : "GET"}]
      app_config: {"foo" : "you should never see this; it should be overwritten by policy"}
      app_preferences: {"foo_updated" : "you should never see this; it should be overwritten by policy"}
      
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          inputs:
            connected_broker_dns_name: { get_input: connected_broker_dns_name }
    relationships:
      - target: hw_app_policy_test
        type: cloudify.relationships.depends_on
   
outputs: 
  hw_cdap_app_name:
    value:
      {get_attribute:[hw_cdap_app, service_component_name]}
